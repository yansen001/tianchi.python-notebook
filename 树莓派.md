# 树莓派学习记录

##  硬件需求

1.树莓派
2.tf卡（内存16以上 ==C10 U1==）
3.micro usb 电源线
4.5V 2A及以上电源（不推荐多协议电源，树莓派非标，IC chip控制输出电流很小）
5.散热片
6.外壳（塑料材质，带风扇）
7.网线（不必须）

## 系统配置
### 系统烧录
1.前往树莓派官网下载Raspbian desktop Buster，使用工具烧入tf卡。
### 开启ssh WiFi设定
2.在tf卡 boot 分区下新建ssh（开启ssh），wpa_supplicant.conf（配置无线网络）
wpa_supplicant.conf 内容如下

```
country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
 
network={
ssid="ASUS_3AC5"
psk="3AC512973"
key_mgmt=WPA-PSK
}
```
3.连接相关线缆，上电
4.查询路由器后台，获得树莓派IP地址，打开Xshell 连接树莓派
5.用户名：pi 密码：raspberry

### 更换国内源
1.修改软件更新源
终端输入```sudo nano /etc/apt/sources.list```
将默认更新源注释掉，另起一行复制原来的更新源，将绿色网址部分更换为国内源
```deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi```
```#deb-src http://mirrors.ustc.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi```
```Ctrl```+```X```退出编辑，```Y```保存
详见[中科大Raspberrypi软件源帮助](https://mirrors.ustc.edu.cn/help/raspbian.html)
2.修改系统更新源
终端输入```sudo nano /etc/apt/sources.list.d/raspi.list```
注释掉默认源，另起一行复制原来的更新源，将绿色网址部分更换为国内源
```deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ buster main```
```#deb-src http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ buster main```
```Ctrl```+```X```退出编辑，```Y```保存
详见[中科大Raspberrypi系统源帮助](https://mirrors.ustc.edu.cn/help/archive.raspberrypi.org.html)

3.系统，软件更新
```sudo apt-get update``` 更新软件信息数据库
```sudo apt-get upgrade```更新软件

### 扩展空间
```sudo raspi-config``` 7 Advanced Options→A1 Expand Filesystem...


### 设置中文显示
```sudo apt-get install ttf-wqy-zenhei``` 安装中文字库
```sudo fc-cache``` 刷新字库
```sudo raspi-config``` 进入配置界面
选择change_licale ,按```*``` 选中```zh_CN.UTF-8 UTF-8```
```Tab```切换到确定，取消栏目，按确定，回车
选择```zh_CN.UTF-8 UTF-8``` 确定，回车
完成后，```sudo reboot```重启树莓派

### 开启 root
```sudo passwd root```更改root密码
```sudo passwd --unlock root``` 解锁root账户
```sudo nano /etc/ssh/sshd_config```设定root可ssh登录
找到PermitRootLogin prohibit-password
另起一行，改为PermitRootLogin yes，并将原始参数注释掉
```reboot```重启

### exFAT 驱动
`sudo apt update`
`sudo apt install exfat-fuse`

### NTFS驱动
`sudo apt update`
`sudo apt install ntfs-3g`

## 软件安装

### Docker

[Docker从入门到实践](https://docker_practice.gitee.io/)
1.更新软件源，安装依赖项

`sudo apt-get update`

```
sudo apt-get install \
apt-transport-https \
ca-certificates \
curl \
gnupg-agent \
software-properties-common
```
2.添加官方GPG密钥：

```
curl -fsSL https://download.docker.com/linux/raspbian/gpg | sudo apt-key add -
```
3.添加Docker CE源
```
sudo add-apt-repository \
    "deb [arch=armhf] https://download.docker.com/linux/raspbian \
    $(lsb_release -cs) \
    stable"
```
4.下载脚本并运行
`curl -fsSL https://get.docker.com -o get-docker.sh`
`sudo sh get-docker.sh`
5.将pi添加到Docker用户组

`sudo usermod -aG docker pi`
详见[Docker官方安装指南](https://docs.docker.com/engine/install/debian/#installation-methods)

5.添加阿里Docker Hub镜像加速
`sudo nano /etc/docker/daemon.json`
增加如下代码

```
{
  "registry-mirrors": ["https://2zt12izj.mirror.aliyuncs.com"]
}
```

### Portainer（Docker GUI）

1.安装Portainer
`docker volume create portainer_data`
```docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer```

## 系统备份记录

### 编号定义
`字母` `字母` `数字`-`硬件型号`_`时间`
第一位字母表示系统类型，并已配置好基本网络，更新源，本土化
第二位字母表示分支
第三位数字表示增量备份版本，1~+∞
时间：记录备份的时间，精确到年月日
==Original型只需标注字母/时间==
例如AB5,表示系统类型为A，A的第B条分支下的第5个增量备份

### A
#### A-3B_2020-4-18 Original 
系统版本:2020-02-13-raspbian-buster-full
更改：配置WiFi : ASUS_3AC5；更换软件，系统源为ustc，安装中文字体
配置用户：pi/raspi;root/raspberry root可ssh登录
rootfs:8320mb
MD5:5460D44651106A3E7E6DF06BC9B070E8

#### AA1-3B_2020-4-19 Docker+Portein
更改:安装Docker19.03.8 采用官方一键脚本方式，安装Portainer1.23.2 
账户：yc/9080737#docker
roofts:8704mb 已用7G 89%
MD5:89BF660509E68010C59BFDE11803B3E7

#### AA2-3B_2020-5-4
更改：添加KMS,PI-dashboard，容器
roofts:8990mb 
MD5: B4321AE41D8AB26A3171434A18F53AC5

### B
#### B-3B_2020-5-4 Original
系统版本：2020-02-13-raspbian-buster-lite
更改：保持wlan联接，未配置WIFI；更换软件，系统源为ustc，安装中文字体
配置用户：pi/raspi;root/raspberry root可ssh登录
roofts:2088mb 增加128mb
MD5:4DD94C2DF77BAC887CA50A8B0F50E169

#### BA1-3B_2020-5-5 Docker+Portein
更改:安装Docker19.03.8 采用官方一键脚本方式，安装Portainer1.23.2 
账户：yc/9080737#docker
roofts:2088mb 未增加
MD5:AC311C7471922944F3D5655D9CE0114B

#### BA2-3B_2020-5-5 
更改：增加KMS服务器
MD5:27470F541898FCDB93A09411CA140F13

## 常用命令
重启 reboot
关机 shutdown -h now / poweroff
切换用户  su xxx
磁盘挂载情况 df -h /fdisk -l
蓝牙扫描 sudo hcitool lescan


## 日常记录
### 2020.5.5
安装了AdGuardHome 要注意看容器架构，官方版本为x86架构
USER:yc PASS:9080737#adguard
端口：webui 3001

2020.12.6 pi/raspberry  root/raspberry



WP

yc.crab

@qIVp#XL^CSk6Mc^84